<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    // 一、发送async请求
    // (async ()=>{
    //     const res = await axios.get('/api/users');
    //     // console.log(res.data);
    //     document.writeln(`Response: ${JSON.stringify(res.data)}`);
    // })()


    // 二、使用埋点发送请求
    // let img = new Image();
    // img.src = '/api/users?abc=123';


    /**
     * 三、跨域请求,
     * 这时候访问页面http://localhost:4000会出现跨域错误, 
     * 解决方法(http.js)：res.setHeader('Access-Control-Allow-Origin', 'http://localhost:4000');
     */
    // (async ()=>{
    //     axios.defaults.baseURL = 'http://localhost:3000';   
    //     const res = await axios.get('/api/users');
    //     document.writeln(`Response: ${JSON.stringify(res.data)}`);
    // })()


    // 四、CORS预检请求, 请求method=OPTIONS
    // (async ()=>{
    //     axios.defaults.baseURL = 'http://localhost:3000';
    //     // get请求
    //     // const res = await axios.get('/api/users', {headers: {'X-Token': 'jilei'}});
    //     // post请求
    //     const res = await axios.post('/api/users', {username: 'test'}, {headers: {'X-Token': 'jilei'}});
    //     document.writeln(`Response: ${JSON.stringify(res.data)}`);
    // })()


    /**
     * 五、解决跨域Cookie不能使用问题：
     * 同源策略：不允许JS访问跨域的Cookie
    */
    // (async ()=>{
    //     axios.defaults.baseURL = 'http://localhost:3000';
    //     axios.defaults.withCredentials = true;
    //     const res = await axios.post('/api/users', {username: 'test'}, {headers: {'X-Token': 'jilei'}});
    //     document.writeln(`Response: ${JSON.stringify(res.data)}`);
    // })()



    /**
     * 六、后台使用proxy解决跨域：
     * 当请求4000端口时，会转发到3000端口的服务器进行处理
    */
    (async ()=>{
        axios.defaults.withCredentials = true;
        const res = await axios.post('/api/users', {username: 'test'}, {headers: {'X-Token': 'jilei'}});
        document.writeln(`Response: ${JSON.stringify(res.data)}`);
    })()
</script>